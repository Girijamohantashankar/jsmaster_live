"use strict";(()=>{var e={};e.id=9378,e.ids=[9378],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,n){return n in r?r[n]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,n)):"function"==typeof r&&"default"===n?r:void 0}}})},2006:(e,r,n)=>{n.r(r),n.d(r,{config:()=>m,default:()=>c,routeModule:()=>g});var t={};n.r(t),n.d(t,{default:()=>f});var o=n(1802),i=n(7153),s=n(6249),a=n(1163),u=n(3248),l=n(9344),d=n.n(l);let p=process.env.JWT_SECRET;async function f(e,r){if(await (0,a.Z)(),"GET"===e.method){let n=e.headers.authorization?.split(" ")[1];if(!n)return r.status(401).json({message:"Token not provided"});try{let e=d().verify(n,p),t=await u.Z.findById(e.id);if(!t)return r.status(404).json({message:"User not found"});let o=t.username.charAt(0).toUpperCase();r.status(200).json({userInitial:o})}catch(e){if("TokenExpiredError"===e.name)return console.error("JWT token expired:",e),r.status(401).json({message:"Token expired. Please log in again."});console.error("Error fetching user:",e),r.status(500).json({message:"Server error"})}}else r.status(405).json({message:"Method not allowed"})}let c=(0,s.l)(t,"default"),m=(0,s.l)(t,"config"),g=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/user-initial",pathname:"/api/user-initial",bundlePath:"",filename:""},userland:t})},1163:(e,r,n)=>{n.d(r,{Z:()=>a});var t=n(1185),o=n.n(t);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let a=async function(){return s.conn||(s.promise||(s.promise=o().connect(i,{bufferCommands:!1}).then(e=>e)),s.conn=await s.promise),s.conn}},3248:(e,r,n)=>{n.d(r,{Z:()=>s});var t=n(1185),o=n.n(t);let i=new(o()).Schema({username:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},phone:{type:String,required:!0},gender:{type:String,required:!0},otp:{type:String,default:null},otpExpiry:{type:Date,default:null},isVerified:{type:Boolean,default:!1},resetPasswordToken:{type:String,default:null},resetPasswordExpires:{type:Date,default:null}}),s=o().models.User||o().model("User",i)},7153:(e,r)=>{var n;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,r,n)=>{e.exports=n(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var n=r(r.s=2006);module.exports=n})();